import React   from 'react'
import Cart    from '../modules/CartStarterKit.jsx'
import Griddle from 'griddle-react'

const items = {
    "sku-1" : {
        "title" : "Spongebob in the Pocket T-Shirt"
    },
    "sku-2" : {
        "title" : "Gentleman Spongebob T-Shirt"
    },
    "sku-3" : {
        "title" : "Sponge Wars T-Shirt"
    },
    "sku-4" : {
        "title" : "Scooby Doo Mystery Inc. T-Shirt"
    }
}

const MainComponent = React.createClass({
    getInitialState() {
        let data = []
        for (var key in items) {
            let item = items[key]
            item.id = key
            data.push(item)
        }
        return {
            data : data
        }
    },
    handleRowClick(row) {
        let item = row.props.data
        this.refs.cart.addItem(row.props.data.id, 1, item)
    },
//    notifyItemAdded(item) {
//        console.log('--------------------------------------------------')
//        console.log('item added')
//        console.log(item)
//    },
//    notifyItemRemoved(item) {
//        console.log('--------------------------------------------------')
//        console.log('item removed')
//        console.log(item)
//    },
//    notifyQtyChanged(item, quantity, oldQty) {
//        console.log('--------------------------------------------------')
//        console.log('item quantity changed')
//        console.log(item)
//        console.log('New quantity : ' + quantity)
//        console.log('Old quantity : ' + oldQty)
//    },
    handleSubmit() {
        console.log(this.refs.cart.getSelection())
    },
    handleEmptyCart() {
        this.refs.cart.emptyCart()
    },
    handleReset() {
        this.refs.cart.reset()
    },
    refresh() {
        if (!this.refs.cart) {
            return
        }
        this.setState({
            buttonsVisible : !this.refs.cart.isEmpty()
        })
    },
    componentDidMount() {
        this.refresh()
    },
    rowIterator(context, row) {
        if (!context) {
            return {
                total : 0
            }
        } else {
            let price = Number(row.data['Price'])
            return {
                total : context.total + row.quantity * price
            }
        }
    },
    render() {
        return (
            <div>
                <Griddle 
                  showFilter        = {true}
                  columns           = {['Artist', 'Title', 'Label', 'Country', 'Year', 'Format', 'Price']}
                  useGriddleStyles  = {false}
                  onRowClick        = {this.handleRowClick}
                  results           = {this.state.data} />
                <Cart 
                  ref               = 'cart'
                  onItemAdded       = {this.notifyItemAdded}
                  onItemRemoved     = {this.notifyItemRemoved}
                  onItemQtyChanged  = {this.notifyQtyChanged}
                  onChange          = {this.refresh}
                  columns           = {['product']}
                  iterator          = {this.rowIterator}
                  cartEmptyMessage  = {'No items.'} />
                {this.state.buttonsVisible ? ( 
                    <div>
                        <button onClick={this.handleSubmit}>
                            Submit
                        </button>
                        <button onClick={this.handleEmptyCart}>
                            Clear cart
                        </button>
                    </div>
                ) : <span />}
                <button onClick={this.handleReset}>
                    Reset
                </button>
            </div>
        )
    }
})

React.render(
    <MainComponent />,
    document.getElementById('main')
)
